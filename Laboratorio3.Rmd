---
title: "R Notebook"
output: html_notebook
---

Laboratorio 3

Estadística Computacional


05 de Noviembre del 2017


Andrés Huerta Rojo 201473544-8 andres.huerta.14@sansano.usm.cl Malla Nueva

Gonzalo Duran Saez 201473507-3 gonzalo.duran.14@sansano.usm.cl Malla Nueva



1.

```{r}
library(readr)
library(MASS)
library(dplyr)

reviews <- read.csv("LasVegasTripAdvisorReviews-Dataset.csv", sep=";")
```

a)

Se elige como muestra para analizar los scores de USA y Canada

```{r}
scores_USA <- subset(reviews, User.country == "USA")
scores_canada <- subset(reviews, User.country == "Canada")
```

Se presenta a continuación una tabla con las medias, medianas y desviación estandar de ambos subconjuntos.

```{r}
tabla <- matrix(c(mean(scores_USA$Score, na.rm = TRUE), var(scores_USA$Score, na.rm = TRUE), sd(scores_USA$Score, na.rm = TRUE), median(scores_USA$Score, na.rm = TRUE), mean(scores_canada$Score, na.rm = TRUE), var(scores_canada$Score, na.rm = TRUE), sd(scores_canada$Score, na.rm = TRUE), median(scores_canada$Score, na.rm = TRUE)), ncol = 4, byrow = TRUE)

colnames(tabla) <- c("Media", "Varianza", "Des_Estandar", "Mediana")
rownames(tabla) <- c("USA", "Canada")

tabla <- as.table(tabla)
tabla
```
Se puede ver que en general ambos paises aparentan tener valores similares en cada comparación, la media tiene una diferencia de 0,05 unidades aproximadamente, mientras que la varianza es de 0,16 unidades (es la mayor diferencia apreciable para estos valores), la desviación estandar posee una diferencia de 0,08 y la mediana es igual para ambos casos.

Se puede desprender de esta información dos posibilidades, la primera, en general el publico estado unidense califica su estadia en los hoteles mejor que Canada, la segunda la cantidad de votantes estado unidenses es mucho mayor que la de Canada lo que permite una mejor diferenciación en medias.


```{r}
boxplot(scores_USA$Score, scores_canada$Score, names = c("USA", "Canada"), col = rainbow(2), ylab = "Score", main = "Boxplot de Scores para USA vs Canada")
```
Notar que el segundo cuartil de cada caso se encuentra casi a la misma altura, en general se puede ver que la apreciación de los norteamericanos es mayor que la de los canadienses los cuales tienen una opinion mas variada, tal como se nombro anteriormente.

Se pueden ver un par de valores extremos (outliers) dentro del boxplot de USA, se puede concluir que en muy pocas ocaciones USA califica mal sus propios hoteles.

b)
Se determinan los 10 paises con mayor cantidad de reviews.

```{r}
x2 <- aggregate(reviews$Nr..reviews, by=list(reviews$User.country), FUN=sum)
x2 <- x2[order(-x2$x), ][1:10, ]
x2
```

Se realiza el barplot.

```{r}
barplot(c(12419, 3186, 2128, 1256, 385, 376, 349, 320, 314, 312), main = "Barplot de cantidad de reviews para los 10 paises con mas reviews", col = rainbow(10), names = c("USA", "UK", "Canada", "Australia", "Germany", "Mexico", "India", "Saudi Arabia", "Ireland", "Netherlands"), ylab = "Reviews", cex.names = 0.6)
```
Haciendo referencia a los comentarios anteriores, se puede confirmar gracias a este gráfico que la cantidad de ciudadanos de USA que se hospedan en las vegas es mucho mayor que los de otros paises.

d)

Se procede a calcular el intervalo de confianza de la media, se considera una vez cada hotel para evitar repeticiones. En el codigo se obtiene cada hotel con su cantidad de habitaciones.
Para intervalos de confianza de 90, 95 y 99% respectivamente:
```{r}
Hoteles_VEGAS <- distinct(reviews, Hotels.name, Nr..rooms  , .keep_all = FALSE)

t.test(Hoteles_VEGAS$Nr..rooms, conf.level = 0.90)
t.test(Hoteles_VEGAS$Nr..rooms, conf.level = 0.95)
t.test(Hoteles_VEGAS$Nr..rooms, conf.level = 0.99)

```
Donde se observan los intervalos de confianza como se indica:
Con 90% de confianza: [1701.118, 2691.644]
Con 95% de confianza: [1597.384, 2795.378]
Con 99% de confianza: [1379.324, 3013.437]

Con valor de media muestral igual a 2196.381.


e)
```{r}
chisq.test(reviews$Nr..rooms, reviews$Score)
```
H0 -> los factores son independientes
H1 -> Los factores no son independientes

Si p-valor es menor que el nivel de significancia se rechaza la hipotesis nula, lo cual implica que la independencia se hace presente.




f)

El test Mann-Whitney-Wilcoxon sirve para determinar si 2 muestras siguen la misma distribución sin asumir que siguen una distribución normal.

```{r}
wilcox.test(reviews$Nr..rooms, reviews$Score) 
```
H0 -> las muestras tienen igual distribución
H1 -> las muestras tienen distribución distintas

sigue el mismo caso que lo anterior, si el p-valor es menor que el nivel de significancia entonces no tienen la misma distribución. Se observa que con el p-valor dado, se puede rechazar la hipotesis nula, en valores mayores se acepta, la hipotesis en que las variables tienen distribuciones identicas.

2.

a)

```{r}


USA <- subset(reviews, User.country == "USA" & Member.years >= 0)
#Se eliminarn los valores que no tienen sentidos como la posibilidad de ser un miembro por menos de 0 años.

#Se inicializan las variables en 0
mediana = 0
media = 0
varianza = 0

#Se realizan 1000 muestras de la muestra inicial
for(i in 1:1000){
  muestra <- sample(USA$Member.years, size=200) #Se elige una submuestra aleatoria
  media = media + mean(muestra) #se agrega la media de la submuestra 
  mediana = mediana + median(muestra) #Se agrega la mediana de la submuestra
  varianza = varianza + var(muestra) #Se agrega la varianza de la submuestra
}

#Se obtiene el promedio de todos los datos para obtener un estimador de la mediana, media y varianza.
mediana = mediana / 1000  
media = media / 1000
varianza = varianza / 1000

mediana
media
varianza


```


3.
a)
```{r}
load("sinewave.RData")

plot(dirtywave)
```
    Se puede notar que al final del plot existe un outlier del tipo global, ya que este se encuentra notablemente fuera del rango de valores posibles, desde x = 30 en adelante se podrían considerar dichos outliers del tipo colectivo, ya que estos aparentan tener un comportamiento parecido, pero en puntos distintos, posiblemente se deba a un error de calibración. Finalmente para los 3 primeros outliers se podría considerar igual que el anterior.
    
    
    b)
    Se genera un boxplot para mostrar los outliers mas significativos.
    
```{r}
boxplot(dirtywave$y, col = rainbow(1), main = "Boxplot de dirtywave para determinar outliers", ylab = "y", xlab = "Dirtywave")
```  
    Se puede notar un valor extremo sobre el bigote superior el cual se encuentra cercano al valor 3, al ser un valor muy distinto del rango común de la función se reemplazara el outlier con la media. 
    
```{r}
media <- mean(dirtywave$y)


outlier.replace(dirtywave$y, alpha = 0.05, value = media)
```

    
    
    c) 
    
    
    
    
    
    d)
    
    
    
    
    e)
    
    
    
  
